
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A git commit hook helps you keep your code clean - naxoc.net</title>
  <meta name="author" content="Camilla Krag Jensen">

  
  <meta name="description" content="I like to keep my code free of trailing whitespace. I feel what xjm describes as &ldquo;spinach in your teeth&rdquo; about whitespace and non- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://naxoc.github.io/2012/11/26/a-git-commit-hook-helps-you-keep-your-code-clean/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="naxoc.net" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15300952-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:naxoc.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="site-title">
            naxoc.net
        </span>
       
           <span class="site-subtitle">
             Liking the holes in cheese since 1975
           </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Git Commit Hook Helps You Keep Your Code Clean</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-26T22:18:00+01:00" pubdate data-updated="true">Nov 26<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I like to keep my code free of trailing whitespace. I feel what xjm describes as &ldquo;<a href="http://xjm.drupalgardens.com/review-guide">spinach in your teeth</a>&rdquo; about whitespace and non-conforming coding standards.</p>

<p>I got (heavily) inspired by Josh The Geek&rsquo;s <a href="http://drupal.org/sandbox/JoshTheGeek/1143338">git pre-commit hook</a>, and made myself a commit hook that will check the code I am about to commit for common errors. In addition to whitespace, I like to make sure that I don&rsquo;t accidentally commit debug code like <code>krumo()</code>. The commit hook also checks for common calls to debug functions.</p>

<p>If you want to use it, simply put it in your .git/hooks folder in your git checkout. Make sure the file is executable with <code>chmod +x .git/hooks/pre-commit</code>. This will only effect the git checkout you put the commit hook in, but you can make it apply to all future checkouts by putting it in your git install directory&rsquo;s template folder. Where that folder is will vary, but on my mac it is in /usr/share/git-core/templates/hooks.</p>

<p>The script is not the most clever in the world, so it will be wrong about some things from time to time. You can override it and still commit with the command <code>git commit -n</code></p>

<p>Here is the pre-commit file:</p>

<div><script src='https://gist.github.com/4150599.js'></script>
<script type="text/javascript">$(".gist-file table tr td.line-numbers").remove();</script>
<noscript><pre><code>#!/usr/bin/php
&lt;?php
/**
 * @file
 * This is a Git pre-commit hook that informs you when you are
 * about to commit whitespace or a debug function.
 */

$red = &quot;\033[1;31m&quot;;
$red_end = &quot;\033[0m&quot;;

$yellow = &quot;\033[1;33m&quot;;
$yellow_end = &quot;\033[0m&quot;;

/**
 * An array of functions to check for.
 */
$check = array();
$check[] = ' dsm(';
$check[] = ' dpm(';
$check[] = ' dpr(';
$check[] = ' dprint_r(';
$check[] = ' db_queryd(';
$check[] = ' krumo';
$check[] = ' kpr(';
$check[] = ' kprint_r(';
$check[] = ' var_dump(';
$check[] = ' dd(';
$check[] = ' drupal_debug(';
$check[] = ' dpq(';

$return = 0;
$diff = array();
exec('git diff --staged', $diff, $return);

if ($return !== 0) {
  fwrite(STDOUT, &quot;git diff returned an error. Commit aborted.\n&quot;);
  exit(1);
}

foreach ($diff as $lineno =&gt; $line) {
  if (substr($line, 0, 1) != '+') {
    // Skip the line if you aren't adding something that may contain a debug
    // function call.
    continue;
  }
  foreach ($check as $lineno =&gt; $function) {
    if (strstr($line, $function)) {
      fwrite(STDOUT, &quot;{$red}Oh, noes! You were about to commit a $function)?{$red_end}\n&quot;);
      fwrite(STDOUT, $yellow . $line . $yellow_end);
      fwrite(STDOUT, &quot;\nCommit aborted.\n&quot;);
      exit(3);
    }
  }
}

$whitespace = shell_exec('git diff --staged --check');
if (!empty($whitespace)) {
  fwrite(STDOUT, &quot;{$red}Commit aborted. Fix trailing whitespace.{$red_end}\n&quot;);
  fwrite(STDOUT, $yellow . $whitespace . $yellow_end);
  exit(4);
}

// If this is still running, all is peachy. Let the developer commit.
exit(0);</code></pre></noscript></div>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Camilla Krag Jensen</span></span>

      








  


<time datetime="2012-11-26T22:18:00+01:00" pubdate data-updated="true">Nov 26<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/drupal-planet/'>Drupal Planet</a>, <a class='category' href='/blog/categories/drupal/'>drupal</a>, <a class='category' href='/blog/categories/git/'>git</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/06/05/using-specific-versions-of-formula-with-homebrew/" title="Previous Post: Using specific versions of formula with Homebrew">&laquo; Using specific versions of formula with Homebrew</a>
      
      
        <a class="basic-alignment right" href="/2013/10/06/setting-up-a-file-watcher-for-compass-in-phpstorm/" title="Next Post: Setting up a file watcher for Compass in PHPStorm">Setting up a file watcher for Compass in PHPStorm &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/10/22/windows-in-virtualbox-on-the-mac/">Windows in VirtualBox on the Mac</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/06/setting-up-a-file-watcher-for-compass-in-phpstorm/">Setting up a file watcher for Compass in PHPStorm</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/26/a-git-commit-hook-helps-you-keep-your-code-clean/">A git commit hook helps you keep your code clean</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/05/using-specific-versions-of-formula-with-homebrew/">Using specific versions of formula with Homebrew</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/05/whats-with-the-weird-name/">What's with the weird name?</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>On Goodreads</h1>
  <div id="goodreads"></div>
      <style type="text/css" media="screen">
        .gr_grid_container {
          /* customize grid container div here. eg: width: 500px; */
        }

        .gr_grid_book_container {
          /* customize book cover container div here */
          float: left;
          width: 98px;
          height: 160px;
          padding: 0px 0px;
          overflow: hidden;
        }
      </style>
      <div id="gr_grid_widget_1375689543">
        <!-- Show static html as a placeholder in case js is not enabled - javascript include will override this if things work -->
          <div class="gr_grid_container">
          </div>
      </div>
      <script src="http://www.goodreads.com/review/grid_widget/1493819.Camilla's%20bookshelf:%20read?cover_size=medium&hide_link=true&hide_title=true&num_books=20&order=d&shelf=read&sort=date_read&widget_id=1375689543" type="text/javascript" charset="utf-8"></script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Camilla Krag Jensen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'naxocnet';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://naxoc.github.io/2012/11/26/a-git-commit-hook-helps-you-keep-your-code-clean/';
        var disqus_url = 'http://naxoc.github.io/2012/11/26/a-git-commit-hook-helps-you-keep-your-code-clean/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
